"use strict";(globalThis.webpackChunkmon_site=globalThis.webpackChunkmon_site||[]).push([[6964],{5051(e,n,s){s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"tuto-vps/changer-port-ssh","title":"Changer le port SSH","description":"Guide pour modifier le port SSH par d\xe9faut et am\xe9liorer la s\xe9curit\xe9 de votre VPS.","source":"@site/docs/tuto-vps/changer-port-ssh.md","sourceDirName":"tuto-vps","slug":"/tuto-vps/changer-port-ssh","permalink":"/docs/tuto-vps/changer-port-ssh","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1771979316000,"sidebarPosition":3,"frontMatter":{"title":"Changer le port SSH","sidebar_position":3},"sidebar":"docs","previous":{"title":"Se connecter en SSH","permalink":"/docs/tuto-vps/se-connecter-ssh"},"next":{"title":"Installer Node.js & NVM","permalink":"/docs/tuto-vps/installer-nodejs"}}');var r=s(4848),l=s(8453);const t={title:"Changer le port SSH",sidebar_position:3},o=void 0,c={},a=[{value:"Pourquoi changer le port SSH ?",id:"pourquoi-changer-le-port-ssh-",level:2},{value:"Choix du nouveau port",id:"choix-du-nouveau-port",level:2},{value:"Ports recommand\xe9s",id:"ports-recommand\xe9s",level:3},{value:"V\xe9rifier disponibilit\xe9",id:"v\xe9rifier-disponibilit\xe9",level:3},{value:"Proc\xe9dure de changement",id:"proc\xe9dure-de-changement",level:2},{value:"\xc9tape 1 : Backup configuration",id:"\xe9tape-1--backup-configuration",level:3},{value:"\xc9tape 2 : Ouvrir nouveau port dans firewall",id:"\xe9tape-2--ouvrir-nouveau-port-dans-firewall",level:3},{value:"\xc9tape 3 : Modifier configuration SSH",id:"\xe9tape-3--modifier-configuration-ssh",level:3},{value:"\xc9tape 4 : V\xe9rifier syntaxe",id:"\xe9tape-4--v\xe9rifier-syntaxe",level:3},{value:"\xc9tape 5 : Red\xe9marrer SSH",id:"\xe9tape-5--red\xe9marrer-ssh",level:3},{value:"\xc9tape 6 : Tester nouvelle connexion",id:"\xe9tape-6--tester-nouvelle-connexion",level:3},{value:"\xc9tape 7 : Fermer ancien port (optionnel)",id:"\xe9tape-7--fermer-ancien-port-optionnel",level:3},{value:"Configuration SELinux (CentOS/RHEL)",id:"configuration-selinux-centosrhel",level:2},{value:"Connexion avec nouveau port",id:"connexion-avec-nouveau-port",level:2},{value:"Ligne de commande",id:"ligne-de-commande",level:3},{value:"PuTTY",id:"putty",level:3},{value:"Fichier config SSH",id:"fichier-config-ssh",level:3},{value:"Scripts et cron",id:"scripts-et-cron",level:3},{value:"D\xe9pannage",id:"d\xe9pannage",level:2},{value:"Impossible de se connecter au nouveau port",id:"impossible-de-se-connecter-au-nouveau-port",level:3},{value:"Bloqu\xe9 dehors",id:"bloqu\xe9-dehors",level:3},{value:"Port d\xe9j\xe0 utilis\xe9",id:"port-d\xe9j\xe0-utilis\xe9",level:3},{value:"SELinux bloque",id:"selinux-bloque",level:3},{value:"S\xe9curit\xe9 renforc\xe9e",id:"s\xe9curit\xe9-renforc\xe9e",level:2},{value:"Multiple changements simultan\xe9s",id:"multiple-changements-simultan\xe9s",level:3},{value:"Fail2Ban sur nouveau port",id:"fail2ban-sur-nouveau-port",level:3},{value:"Port Knocking (avanc\xe9)",id:"port-knocking-avanc\xe9",level:3},{value:"Migration d&#39;infrastructure",id:"migration-dinfrastructure",level:2},{value:"Documentation \xe9quipe",id:"documentation-\xe9quipe",level:3},{value:"Terraform",id:"terraform",level:3},{value:"Monitoring",id:"monitoring",level:2},{value:"Surveiller tentatives connexion",id:"surveiller-tentatives-connexion",level:3},{value:"Script alerte",id:"script-alerte",level:3},{value:"Logs temps r\xe9el",id:"logs-temps-r\xe9el",level:3},{value:"Best practices",id:"best-practices",level:2},{value:"Checklist avant changement",id:"checklist-avant-changement",level:3},{value:"Apr\xe8s changement",id:"apr\xe8s-changement",level:3},{value:"Rollback",id:"rollback",level:2},{value:"Statistiques impact",id:"statistiques-impact",level:2},{value:"Ressources",id:"ressources",level:2},{value:"Support",id:"support",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"Guide pour modifier le port SSH par d\xe9faut et am\xe9liorer la s\xe9curit\xe9 de votre VPS."}),"\n",(0,r.jsx)(n.h2,{id:"pourquoi-changer-le-port-ssh-",children:"Pourquoi changer le port SSH ?"}),"\n",(0,r.jsxs)(n.p,{children:["Le port ",(0,r.jsx)(n.strong,{children:"22"})," est le port SSH par d\xe9faut, ce qui en fait une cible privil\xe9gi\xe9e des attaques automatis\xe9es."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Avantages :"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2705 R\xe9duction drastique des tentatives de connexion malveillantes"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Logs moins pollu\xe9s"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Moins de charge CPU (moins de tentatives \xe0 traiter)"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Couche de s\xe9curit\xe9 suppl\xe9mentaire"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Inconv\xe9nients :"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u26a0\ufe0f Vous devrez sp\xe9cifier le port lors des connexions"}),"\n",(0,r.jsx)(n.li,{children:"\u26a0\ufe0f Risque de vous bloquer si mal configur\xe9"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"choix-du-nouveau-port",children:"Choix du nouveau port"}),"\n",(0,r.jsx)(n.h3,{id:"ports-recommand\xe9s",children:"Ports recommand\xe9s"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\xc9vitez :"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Ports < 1024 (n\xe9cessitent root)"}),"\n",(0,r.jsx)(n.li,{children:"Ports utilis\xe9s par autres services (80, 443, 3306, etc.)"}),"\n",(0,r.jsx)(n.li,{children:"Ports dans liste IANA"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Recommand\xe9s :"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"2222"})," : Facile \xe0 retenir"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"2200"})," : Alternative commune"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"49152-65535"})," : Range ports dynamiques"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"v\xe9rifier-disponibilit\xe9",children:"V\xe9rifier disponibilit\xe9"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# V\xe9rifier si port d\xe9j\xe0 utilis\xe9\nsudo ss -tulpn | grep :2222\n\n# Si aucun r\xe9sultat = port disponible\n"})}),"\n",(0,r.jsx)(n.h2,{id:"proc\xe9dure-de-changement",children:"Proc\xe9dure de changement"}),"\n",(0,r.jsx)(n.h3,{id:"\xe9tape-1--backup-configuration",children:"\xc9tape 1 : Backup configuration"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Toujours sauvegarder avant modification :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo cp /etc/ssh/sshd_config /etc/ssh/sshd_config.backup\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\xe9tape-2--ouvrir-nouveau-port-dans-firewall",children:"\xc9tape 2 : Ouvrir nouveau port dans firewall"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"CRITIQUE : Faites ceci AVANT de changer le port SSH"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# UFW\nsudo ufw allow 2222/tcp\n\n# V\xe9rifier\nsudo ufw status\n"})}),"\n",(0,r.jsx)(n.admonition,{title:"Ne pas oublier !",type:"danger",children:(0,r.jsx)(n.p,{children:"Si vous ne faites pas cette \xe9tape, vous serez bloqu\xe9 apr\xe8s red\xe9marrage SSH."})}),"\n",(0,r.jsx)(n.h3,{id:"\xe9tape-3--modifier-configuration-ssh",children:"\xc9tape 3 : Modifier configuration SSH"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo nano /etc/ssh/sshd_config\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Trouvez la ligne :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"#Port 22\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Remplacez par :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Port 2222\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Ou ajoutez temporairement les deux ports :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Port 22\nPort 2222\n"})}),"\n",(0,r.jsx)(n.admonition,{title:"Conseil",type:"tip",children:(0,r.jsx)(n.p,{children:"Gardez les deux ports actifs temporairement pour \xe9viter tout blocage. Vous fermerez le port 22 apr\xe8s avoir v\xe9rifi\xe9 que le nouveau fonctionne."})}),"\n",(0,r.jsx)(n.h3,{id:"\xe9tape-4--v\xe9rifier-syntaxe",children:"\xc9tape 4 : V\xe9rifier syntaxe"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo sshd -t\n"})}),"\n",(0,r.jsx)(n.p,{children:"Si aucune erreur affich\xe9e = configuration valide."}),"\n",(0,r.jsx)(n.h3,{id:"\xe9tape-5--red\xe9marrer-ssh",children:"\xc9tape 5 : Red\xe9marrer SSH"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo systemctl restart sshd\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"V\xe9rifier statut :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo systemctl status sshd\n"})}),"\n",(0,r.jsx)(n.p,{children:'Doit afficher "active (running)".'}),"\n",(0,r.jsx)(n.h3,{id:"\xe9tape-6--tester-nouvelle-connexion",children:"\xc9tape 6 : Tester nouvelle connexion"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"SANS FERMER votre session actuelle :"})}),"\n",(0,r.jsxs)(n.p,{children:["Ouvrez un ",(0,r.jsx)(n.strong,{children:"nouveau terminal"})," et testez :"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ssh -p 2222 root@VOTRE_IP\n"})}),"\n",(0,r.jsx)(n.p,{children:"Si connexion r\xe9ussie : \u2705 Changement r\xe9ussi"}),"\n",(0,r.jsx)(n.p,{children:"Si connexion \xe9choue : \u274c Gardez session ouverte et d\xe9boguez"}),"\n",(0,r.jsx)(n.h3,{id:"\xe9tape-7--fermer-ancien-port-optionnel",children:"\xc9tape 7 : Fermer ancien port (optionnel)"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Une fois nouveau port valid\xe9 :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo nano /etc/ssh/sshd_config\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Retirez :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Port 22\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Gardez seulement :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Port 2222\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Red\xe9marrez :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo systemctl restart sshd\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Fermez port 22 dans firewall :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo ufw delete allow 22/tcp\n"})}),"\n",(0,r.jsx)(n.h2,{id:"configuration-selinux-centosrhel",children:"Configuration SELinux (CentOS/RHEL)"}),"\n",(0,r.jsx)(n.p,{children:"Si SELinux activ\xe9, autorisez le nouveau port :"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Installer outils SELinux\nsudo yum install policycoreutils-python-utils\n\n# Autoriser port\nsudo semanage port -a -t ssh_port_t -p tcp 2222\n\n# V\xe9rifier\nsudo semanage port -l | grep ssh\n"})}),"\n",(0,r.jsx)(n.h2,{id:"connexion-avec-nouveau-port",children:"Connexion avec nouveau port"}),"\n",(0,r.jsx)(n.h3,{id:"ligne-de-commande",children:"Ligne de commande"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ssh -p 2222 user@IP\n"})}),"\n",(0,r.jsx)(n.h3,{id:"putty",children:"PuTTY"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Host Name"})," : VOTRE_IP"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Port"})," : 2222"]}),"\n",(0,r.jsx)(n.li,{children:"Sauvegardez session"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"fichier-config-ssh",children:"Fichier config SSH"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:["\xc9ditez ",(0,r.jsx)(n.code,{children:"~/.ssh/config"})," :"]})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Host mon-vps\n    HostName 51.210.123.45\n    User root\n    Port 2222\n    IdentityFile ~/.ssh/id_ed25519\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Connexion simplifi\xe9e :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ssh mon-vps\n"})}),"\n",(0,r.jsx)(n.h3,{id:"scripts-et-cron",children:"Scripts et cron"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Adaptez vos scripts :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Ancien\nscp fichier.txt root@IP:/chemin/\n\n# Nouveau\nscp -P 2222 fichier.txt root@IP:/chemin/\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Attention : SCP utilise -P majuscule (SSH utilise -p minuscule)"})}),"\n",(0,r.jsx)(n.h2,{id:"d\xe9pannage",children:"D\xe9pannage"}),"\n",(0,r.jsx)(n.h3,{id:"impossible-de-se-connecter-au-nouveau-port",children:"Impossible de se connecter au nouveau port"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"1. Session originale toujours ouverte ?"})}),"\n",(0,r.jsx)(n.p,{children:"Si oui, revenez et corrigez."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"2. V\xe9rifier SSH \xe9coute bien le nouveau port :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo ss -tulpn | grep sshd\n"})}),"\n",(0,r.jsx)(n.p,{children:"Doit afficher :"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'tcp   LISTEN  0  128  *:2222  *:*  users:(("sshd",pid=1234))\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"3. Firewall bloque-t-il ?"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo ufw status | grep 2222\n"})}),"\n",(0,r.jsx)(n.p,{children:"Doit afficher :"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"2222/tcp                   ALLOW       Anywhere\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"4. Logs SSH :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo tail -f /var/log/auth.log\n# Ou\nsudo journalctl -u sshd -f\n"})}),"\n",(0,r.jsx)(n.h3,{id:"bloqu\xe9-dehors",children:"Bloqu\xe9 dehors"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Si vous avez ferm\xe9 session avant de tester :"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Solutions :"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Console VNC/KVM via panel"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Connectez-vous via panel h\xe9bergeur"}),"\n",(0,r.jsx)(n.li,{children:"Console d'urgence disponible"}),"\n",(0,r.jsx)(n.li,{children:"Restaurez configuration"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Mode rescue"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"D\xe9marrez en mode rescue"}),"\n",(0,r.jsx)(n.li,{children:"Montez partition"}),"\n",(0,r.jsxs)(n.li,{children:["\xc9ditez ",(0,r.jsx)(n.code,{children:"/mnt/etc/ssh/sshd_config"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Restaurer backup :"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo cp /etc/ssh/sshd_config.backup /etc/ssh/sshd_config\nsudo systemctl restart sshd\n"})}),"\n",(0,r.jsx)(n.h3,{id:"port-d\xe9j\xe0-utilis\xe9",children:"Port d\xe9j\xe0 utilis\xe9"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"sshd: error: Bind to port 2222 on 0.0.0.0 failed: Address already in use.\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Identifier service utilisant port :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo lsof -i :2222\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Choisir port diff\xe9rent."})}),"\n",(0,r.jsx)(n.h3,{id:"selinux-bloque",children:"SELinux bloque"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# D\xe9sactiver temporairement (test)\nsudo setenforce 0\n\n# Si fonctionne = probl\xe8me SELinux\n# R\xe9activez et configurez correctement\nsudo setenforce 1\nsudo semanage port -a -t ssh_port_t -p tcp 2222\n"})}),"\n",(0,r.jsx)(n.h2,{id:"s\xe9curit\xe9-renforc\xe9e",children:"S\xe9curit\xe9 renforc\xe9e"}),"\n",(0,r.jsx)(n.h3,{id:"multiple-changements-simultan\xe9s",children:"Multiple changements simultan\xe9s"}),"\n",(0,r.jsx)(n.p,{children:"Combinez avec autres mesures :"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo nano /etc/ssh/sshd_config\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Configuration s\xe9curis\xe9e compl\xe8te :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"# Port personnalis\xe9\nPort 2222\n\n# Protocole\nProtocol 2\n\n# Authentification\nPermitRootLogin prohibit-password\nPubkeyAuthentication yes\nPasswordAuthentication no\nPermitEmptyPasswords no\n\n# Limitations\nMaxAuthTries 3\nMaxSessions 2\nClientAliveInterval 300\nClientAliveCountMax 2\n\n# D\xe9sactiver fonctions dangereuses\nX11Forwarding no\nAllowTcpForwarding no\nPermitTunnel no\n\n# Utilisateurs autoris\xe9s\nAllowUsers votre_user\n\n# Banner\nBanner /etc/ssh/banner\n"})}),"\n",(0,r.jsx)(n.h3,{id:"fail2ban-sur-nouveau-port",children:"Fail2Ban sur nouveau port"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Adapter configuration :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo nano /etc/fail2ban/jail.local\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ini",children:"[sshd]\nenabled = true\nport = 2222\nfilter = sshd\nlogpath = /var/log/auth.log\nmaxretry = 3\nbantime = 3600\nfindtime = 600\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Red\xe9marrer :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo systemctl restart fail2ban\n"})}),"\n",(0,r.jsx)(n.h3,{id:"port-knocking-avanc\xe9",children:"Port Knocking (avanc\xe9)"}),"\n",(0,r.jsx)(n.p,{children:"Masquer compl\xe8tement SSH :"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo apt install knockd\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Configuration :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo nano /etc/knockd.conf\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"[openSSH]\n    sequence    = 7000,8000,9000\n    seq_timeout = 5\n    command     = /sbin/iptables -A INPUT -s %IP% -p tcp --dport 2222 -j ACCEPT\n    \n[closeSSH]\n    sequence    = 9000,8000,7000\n    seq_timeout = 5\n    command     = /sbin/iptables -D INPUT -s %IP% -p tcp --dport 2222 -j ACCEPT\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Usage :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"knock IP 7000 8000 9000\nssh -p 2222 user@IP\nknock IP 9000 8000 7000\n"})}),"\n",(0,r.jsx)(n.h2,{id:"migration-dinfrastructure",children:"Migration d'infrastructure"}),"\n",(0,r.jsx)(n.h3,{id:"documentation-\xe9quipe",children:"Documentation \xe9quipe"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Informez votre \xe9quipe :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-markdown",children:"# NOUVEAU PORT SSH : 2222\n\n**Depuis :** 09/01/2024\n\n**Connexion :**\n```bash\nssh -p 2222 user@51.210.123.45\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Scripts \xe0 mettre \xe0 jour :"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"backup.sh"}),"\n",(0,r.jsx)(n.li,{children:"deploy.sh"}),"\n",(0,r.jsx)(n.li,{children:"monitoring.sh"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\n### Automatisation d\xe9ploiement\n\n**Ansible playbook :**\n\n```yaml\n- name: Change SSH Port\n  hosts: all\n  become: yes\n  tasks:\n    - name: Open new port in UFW\n      ufw:\n        rule: allow\n        port: 2222\n        proto: tcp\n        \n    - name: Update sshd_config\n      lineinfile:\n        path: /etc/ssh/sshd_config\n        regexp: '^Port '\n        line: 'Port 2222'\n        \n    - name: Restart SSH\n      systemd:\n        name: sshd\n        state: restarted\n"})}),"\n",(0,r.jsx)(n.h3,{id:"terraform",children:"Terraform"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-hcl",children:'resource "null_resource" "change_ssh_port" {\n  provisioner "remote-exec" {\n    inline = [\n      "sudo ufw allow 2222/tcp",\n      "sudo sed -i \'s/^#Port 22/Port 2222/\' /etc/ssh/sshd_config",\n      "sudo systemctl restart sshd"\n    ]\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"monitoring",children:"Monitoring"}),"\n",(0,r.jsx)(n.h3,{id:"surveiller-tentatives-connexion",children:"Surveiller tentatives connexion"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Connexions r\xe9ussies\nsudo grep "Accepted" /var/log/auth.log | grep "port 2222"\n\n# Tentatives \xe9chou\xe9es\nsudo grep "Failed" /var/log/auth.log | grep "port 2222"\n\n# Statistiques\nsudo grep "port 2222" /var/log/auth.log | wc -l\n'})}),"\n",(0,r.jsx)(n.h3,{id:"script-alerte",children:"Script alerte"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# check-ssh-attempts.sh\n\nFAILED=$(grep "Failed password" /var/log/auth.log | grep "port 2222" | wc -l)\n\nif [ $FAILED -gt 10 ]; then\n    echo "\u26a0\ufe0f $FAILED tentatives SSH \xe9chou\xe9es d\xe9tect\xe9es"\n    # Envoyer notification Discord/Email\nfi\n'})}),"\n",(0,r.jsx)(n.h3,{id:"logs-temps-r\xe9el",children:"Logs temps r\xe9el"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'sudo tail -f /var/log/auth.log | grep --line-buffered "port 2222"\n'})}),"\n",(0,r.jsx)(n.h2,{id:"best-practices",children:"Best practices"}),"\n",(0,r.jsx)(n.h3,{id:"checklist-avant-changement",children:"Checklist avant changement"}),"\n",(0,r.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Backup configuration actuelle"]}),"\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Ouvrir nouveau port dans firewall"]}),"\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Modifier sshd_config"]}),"\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Tester syntaxe (",(0,r.jsx)(n.code,{children:"sshd -t"}),")"]}),"\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Red\xe9marrer SSH"]}),"\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Tester connexion nouveau port SANS fermer session actuelle"]}),"\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Valider fonctionnement"]}),"\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Documenter changement"]}),"\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Informer \xe9quipe"]}),"\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Mettre \xe0 jour scripts"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"apr\xe8s-changement",children:"Apr\xe8s changement"}),"\n",(0,r.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",disabled:!0})," ","V\xe9rifier logs r\xe9guli\xe8rement"]}),"\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Adapter Fail2Ban"]}),"\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Mettre \xe0 jour monitoring"]}),"\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Tester backups"]}),"\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Documenter proc\xe9dure rollback"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"rollback",children:"Rollback"}),"\n",(0,r.jsx)(n.p,{children:"Si probl\xe8me, revenir \xe0 port 22 :"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Via console VNC/KVM du panel\nsudo nano /etc/ssh/sshd_config\n\n# Remettre Port 22\nPort 22\n\n# Sauvegarder et red\xe9marrer\nsudo systemctl restart sshd\n\n# Ouvrir port 22\nsudo ufw allow 22/tcp\n"})}),"\n",(0,r.jsx)(n.h2,{id:"statistiques-impact",children:"Statistiques impact"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Avant changement (port 22) :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"- 5000+ tentatives connexion/jour\n- Logs pollu\xe9s\n- CPU gaspill\xe9\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Apr\xe8s changement (port 2222) :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"- <10 tentatives/jour\n- Logs propres\n- Ressources \xe9conomis\xe9es\n"})}),"\n",(0,r.jsx)(n.h2,{id:"ressources",children:"Ressources"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://man.openbsd.org/sshd_config",children:"OpenSSH sshd_config Manual"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.ssh.com/academy/ssh/sshd_config",children:"SSH Security Best Practices"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://help.ubuntu.com/community/UFW",children:"UFW Guide"})}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"support",children:"Support"}),"\n",(0,r.jsxs)(n.p,{children:["Probl\xe8me lors du changement de port ? ",(0,r.jsx)(n.a,{href:"https://discord.gg/UaHNnMarQA",children:"Discord LKL Cloud"})]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453(e,n,s){s.d(n,{R:()=>t,x:()=>o});var i=s(6540);const r={},l=i.createContext(r);function t(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);