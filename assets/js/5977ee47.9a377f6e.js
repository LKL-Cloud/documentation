"use strict";(globalThis.webpackChunkmon_site=globalThis.webpackChunkmon_site||[]).push([[8898],{5511(e,n,s){s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"tuto-vps/configurer-reverse-proxy","title":"Configurer un Reverse Proxy","description":"Guide pour configurer Nginx comme reverse proxy et g\xe9rer plusieurs applications sur un m\xeame serveur.","source":"@site/docs/tuto-vps/configurer-reverse-proxy.md","sourceDirName":"tuto-vps","slug":"/tuto-vps/configurer-reverse-proxy","permalink":"/docs/tuto-vps/configurer-reverse-proxy","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1772039387000,"sidebarPosition":7,"frontMatter":{"title":"Configurer un Reverse Proxy","sidebar_position":7},"sidebar":"docs","previous":{"title":"Installer Docker & Docker Compose","permalink":"/docs/tuto-vps/installer-docker"},"next":{"title":"Monitoring serveur","permalink":"/docs/tuto-vps/monitoring-serveur"}}');var i=s(4848),t=s(8453);const o={title:"Configurer un Reverse Proxy",sidebar_position:7},a=void 0,l={},c=[{value:"Qu&#39;est-ce qu&#39;un Reverse Proxy ?",id:"quest-ce-quun-reverse-proxy-",level:2},{value:"Installation Nginx",id:"installation-nginx",level:2},{value:"Configuration de base",id:"configuration-de-base",level:2},{value:"Structure des fichiers",id:"structure-des-fichiers",level:3},{value:"nginx.conf principal",id:"nginxconf-principal",level:3},{value:"Exemple 1 : Application Node.js",id:"exemple-1--application-nodejs",level:2},{value:"Configuration backend",id:"configuration-backend",level:3},{value:"Configuration Nginx",id:"configuration-nginx",level:3},{value:"Exemple 2 : Plusieurs applications",id:"exemple-2--plusieurs-applications",level:2},{value:"Configuration multi-apps",id:"configuration-multi-apps",level:3},{value:"SSL/TLS avec Let&#39;s Encrypt",id:"ssltls-avec-lets-encrypt",level:2},{value:"Installation Certbot",id:"installation-certbot",level:3},{value:"Obtenir certificats",id:"obtenir-certificats",level:3},{value:"Configuration apr\xe8s SSL",id:"configuration-apr\xe8s-ssl",level:3},{value:"Renouvellement automatique",id:"renouvellement-automatique",level:3},{value:"WebSockets",id:"websockets",level:2},{value:"Load Balancing",id:"load-balancing",level:2},{value:"Cache avec Nginx",id:"cache-avec-nginx",level:2},{value:"Fichiers statiques",id:"fichiers-statiques",level:2},{value:"S\xe9curit\xe9",id:"s\xe9curit\xe9",level:2},{value:"Rate limiting",id:"rate-limiting",level:3},{value:"Headers de s\xe9curit\xe9",id:"headers-de-s\xe9curit\xe9",level:3},{value:"Restriction IP",id:"restriction-ip",level:3},{value:"Basic Auth",id:"basic-auth",level:3},{value:"Monitoring et logs",id:"monitoring-et-logs",level:2},{value:"Logs par vhost",id:"logs-par-vhost",level:3},{value:"Format de log personnalis\xe9",id:"format-de-log-personnalis\xe9",level:3},{value:"Analyser logs",id:"analyser-logs",level:3},{value:"D\xe9pannage",id:"d\xe9pannage",level:2},{value:"Tester configuration",id:"tester-configuration",level:3},{value:"&quot;502 Bad Gateway&quot;",id:"502-bad-gateway",level:3},{value:"&quot;504 Gateway Timeout&quot;",id:"504-gateway-timeout",level:3},{value:"Logs en temps r\xe9el",id:"logs-en-temps-r\xe9el",level:3},{value:"Best practices",id:"best-practices",level:2},{value:"Structure organis\xe9e",id:"structure-organis\xe9e",level:3},{value:"Fichiers include",id:"fichiers-include",level:3},{value:"Reload vs Restart",id:"reload-vs-restart",level:3},{value:"Ressources",id:"ressources",level:2},{value:"Support",id:"support",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"Guide pour configurer Nginx comme reverse proxy et g\xe9rer plusieurs applications sur un m\xeame serveur."}),"\n",(0,i.jsx)(n.h2,{id:"quest-ce-quun-reverse-proxy-",children:"Qu'est-ce qu'un Reverse Proxy ?"}),"\n",(0,i.jsx)(n.p,{children:"Un reverse proxy est un serveur interm\xe9diaire qui :"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Re\xe7oit requ\xeates HTTP/HTTPS des clients"}),"\n",(0,i.jsx)(n.li,{children:"Les transmet aux serveurs backend appropri\xe9s"}),"\n",(0,i.jsx)(n.li,{children:"Retourne les r\xe9ponses aux clients"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Avantages :"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u2705 H\xe9berger plusieurs apps sur un serveur (diff\xe9rents domaines/sous-domaines)"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 SSL/TLS centralis\xe9"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Load balancing"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Cache et compression"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Protection backend (ne pas exposer directement)"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Cas d'usage :"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Application Node.js sur port 3000 \u2192 Accessible via domaine.com"}),"\n",(0,i.jsx)(n.li,{children:"Bot Discord sur port 8080 \u2192 bot.domaine.com"}),"\n",(0,i.jsx)(n.li,{children:"API sur port 5000 \u2192 api.domaine.com"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"installation-nginx",children:"Installation Nginx"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Mettre \xe0 jour syst\xe8me\nsudo apt update\n\n# Installer Nginx\nsudo apt install nginx -y\n\n# D\xe9marrer et activer\nsudo systemctl start nginx\nsudo systemctl enable nginx\n\n# V\xe9rifier status\nsudo systemctl status nginx\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Tester :"})}),"\n",(0,i.jsxs)(n.p,{children:["Acc\xe9dez \xe0 ",(0,i.jsx)(n.code,{children:"http://VOTRE_IP"})," dans navigateur. Devrait afficher page Nginx par d\xe9faut."]}),"\n",(0,i.jsx)(n.h2,{id:"configuration-de-base",children:"Configuration de base"}),"\n",(0,i.jsx)(n.h3,{id:"structure-des-fichiers",children:"Structure des fichiers"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"/etc/nginx/\n\u251c\u2500\u2500 nginx.conf              # Configuration principale\n\u251c\u2500\u2500 sites-available/        # Configs disponibles\n\u2502   \u251c\u2500\u2500 default\n\u2502   \u2514\u2500\u2500 mon-site\n\u251c\u2500\u2500 sites-enabled/          # Configs actives (symlinks)\n\u2502   \u2514\u2500\u2500 default -> ../sites-available/default\n\u2514\u2500\u2500 conf.d/                 # Configs additionnelles\n"})}),"\n",(0,i.jsx)(n.h3,{id:"nginxconf-principal",children:"nginx.conf principal"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo nano /etc/nginx/nginx.conf\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Configuration optimis\xe9e :"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-nginx",children:"user www-data;\nworker_processes auto;\npid /run/nginx.pid;\n\nevents {\n    worker_connections 1024;\n    use epoll;\n}\n\nhttp {\n    # Basic Settings\n    sendfile on;\n    tcp_nopush on;\n    tcp_nodelay on;\n    keepalive_timeout 65;\n    types_hash_max_size 2048;\n    server_tokens off;\n\n    # Mime types\n    include /etc/nginx/mime.types;\n    default_type application/octet-stream;\n\n    # Logging\n    access_log /var/log/nginx/access.log;\n    error_log /var/log/nginx/error.log;\n\n    # Gzip compression\n    gzip on;\n    gzip_vary on;\n    gzip_proxied any;\n    gzip_comp_level 6;\n    gzip_types text/plain text/css text/xml text/javascript \n               application/json application/javascript application/xml+rss \n               application/rss+xml font/truetype font/opentype \n               application/vnd.ms-fontobject image/svg+xml;\n\n    # Include virtual hosts\n    include /etc/nginx/conf.d/*.conf;\n    include /etc/nginx/sites-enabled/*;\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"exemple-1--application-nodejs",children:"Exemple 1 : Application Node.js"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Sc\xe9nario :"})," App Node.js sur port 3000, accessible via ",(0,i.jsx)(n.code,{children:"monsite.com"})]}),"\n",(0,i.jsx)(n.h3,{id:"configuration-backend",children:"Configuration backend"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"app.js :"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"const express = require('express');\nconst app = express();\n\napp.get('/', (req, res) => {\n    res.send('Hello from Node.js!');\n});\n\napp.listen(3000, 'localhost', () => {\n    console.log('App running on port 3000');\n});\n"})}),"\n",(0,i.jsx)(n.admonition,{title:"Important",type:"tip",children:(0,i.jsxs)(n.p,{children:["L'app \xe9coute sur ",(0,i.jsx)(n.code,{children:"localhost:3000"}),", pas ",(0,i.jsx)(n.code,{children:"0.0.0.0:3000"}),". Nginx sera le seul point d'entr\xe9e public."]})}),"\n",(0,i.jsx)(n.h3,{id:"configuration-nginx",children:"Configuration Nginx"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo nano /etc/nginx/sites-available/monsite\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Contenu :"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-nginx",children:"server {\n    listen 80;\n    server_name monsite.com www.monsite.com;\n\n    location / {\n        proxy_pass http://localhost:3000;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection 'upgrade';\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        proxy_cache_bypass $http_upgrade;\n    }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Activer :"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo ln -s /etc/nginx/sites-available/monsite /etc/nginx/sites-enabled/\nsudo nginx -t\nsudo systemctl reload nginx\n"})}),"\n",(0,i.jsx)(n.h2,{id:"exemple-2--plusieurs-applications",children:"Exemple 2 : Plusieurs applications"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Sc\xe9nario :"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Site principal : ",(0,i.jsx)(n.code,{children:"domaine.com"})," \u2192 Port 3000"]}),"\n",(0,i.jsxs)(n.li,{children:["API : ",(0,i.jsx)(n.code,{children:"api.domaine.com"})," \u2192 Port 5000"]}),"\n",(0,i.jsxs)(n.li,{children:["Admin : ",(0,i.jsx)(n.code,{children:"admin.domaine.com"})," \u2192 Port 8080"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"configuration-multi-apps",children:"Configuration multi-apps"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-nginx",children:"# Site principal\nserver {\n    listen 80;\n    server_name domaine.com www.domaine.com;\n\n    location / {\n        proxy_pass http://localhost:3000;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    }\n}\n\n# API\nserver {\n    listen 80;\n    server_name api.domaine.com;\n\n    location / {\n        proxy_pass http://localhost:5000;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        \n        # CORS headers si n\xe9cessaire\n        add_header 'Access-Control-Allow-Origin' '*';\n        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';\n    }\n}\n\n# Admin\nserver {\n    listen 80;\n    server_name admin.domaine.com;\n\n    # Restriction IP (optionnel)\n    allow 1.2.3.4;\n    deny all;\n\n    location / {\n        proxy_pass http://localhost:8080;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"ssltls-avec-lets-encrypt",children:"SSL/TLS avec Let's Encrypt"}),"\n",(0,i.jsx)(n.h3,{id:"installation-certbot",children:"Installation Certbot"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo apt install certbot python3-certbot-nginx -y\n"})}),"\n",(0,i.jsx)(n.h3,{id:"obtenir-certificats",children:"Obtenir certificats"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Pour un domaine :"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo certbot --nginx -d monsite.com -d www.monsite.com\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Pour plusieurs domaines simultan\xe9ment :"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo certbot --nginx \\\n  -d domaine.com -d www.domaine.com \\\n  -d api.domaine.com \\\n  -d admin.domaine.com\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Interactif :"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Email : ",(0,i.jsx)(n.a,{href:"mailto:votre@email.com",children:"votre@email.com"})]}),"\n",(0,i.jsx)(n.li,{children:"Accepter TOS : Yes"}),"\n",(0,i.jsx)(n.li,{children:"Redirection HTTP \u2192 HTTPS : 2 (Recommand\xe9)"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"configuration-apr\xe8s-ssl",children:"Configuration apr\xe8s SSL"}),"\n",(0,i.jsx)(n.p,{children:"Certbot modifie automatiquement votre config :"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-nginx",children:"server {\n    listen 80;\n    server_name monsite.com www.monsite.com;\n    return 301 https://$server_name$request_uri;\n}\n\nserver {\n    listen 443 ssl http2;\n    server_name monsite.com www.monsite.com;\n\n    ssl_certificate /etc/letsencrypt/live/monsite.com/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/monsite.com/privkey.pem;\n    include /etc/letsencrypt/options-ssl-nginx.conf;\n    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;\n\n    location / {\n        proxy_pass http://localhost:3000;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"renouvellement-automatique",children:"Renouvellement automatique"}),"\n",(0,i.jsx)(n.p,{children:"Certbot configure automatiquement cron. Tester :"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo certbot renew --dry-run\n"})}),"\n",(0,i.jsx)(n.h2,{id:"websockets",children:"WebSockets"}),"\n",(0,i.jsx)(n.p,{children:"Pour applications n\xe9cessitant WebSockets (Socket.IO, etc.)."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-nginx",children:'server {\n    listen 443 ssl http2;\n    server_name chat.domaine.com;\n\n    ssl_certificate /etc/letsencrypt/live/chat.domaine.com/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/chat.domaine.com/privkey.pem;\n\n    location / {\n        proxy_pass http://localhost:3000;\n        proxy_http_version 1.1;\n        \n        # WebSocket headers\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection "upgrade";\n        \n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        \n        # Timeouts pour WebSocket\n        proxy_connect_timeout 7d;\n        proxy_send_timeout 7d;\n        proxy_read_timeout 7d;\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"load-balancing",children:"Load Balancing"}),"\n",(0,i.jsx)(n.p,{children:"R\xe9partir charge entre plusieurs instances."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-nginx",children:"upstream backend {\n    # M\xe9thode de distribution\n    least_conn;  # ou ip_hash, ou round_robin (d\xe9faut)\n    \n    server localhost:3000 weight=3;\n    server localhost:3001 weight=2;\n    server localhost:3002 weight=1;\n    \n    # Backup server\n    server localhost:3003 backup;\n}\n\nserver {\n    listen 443 ssl http2;\n    server_name monsite.com;\n\n    location / {\n        proxy_pass http://backend;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        \n        # Health check\n        proxy_next_upstream error timeout invalid_header http_500 http_502 http_503;\n        proxy_connect_timeout 2s;\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"cache-avec-nginx",children:"Cache avec Nginx"}),"\n",(0,i.jsx)(n.p,{children:"Am\xe9liorer performances en cachant r\xe9ponses."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-nginx",children:"# D\xe9finir zone cache\nproxy_cache_path /var/cache/nginx levels=1:2 keys_zone=my_cache:10m max_size=1g \n                 inactive=60m use_temp_path=off;\n\nserver {\n    listen 443 ssl http2;\n    server_name api.domaine.com;\n\n    location / {\n        proxy_pass http://localhost:5000;\n        \n        # Cache configuration\n        proxy_cache my_cache;\n        proxy_cache_use_stale error timeout updating http_500 http_502 http_503 http_504;\n        proxy_cache_background_update on;\n        proxy_cache_lock on;\n        \n        # Cache headers\n        proxy_cache_valid 200 302 60m;\n        proxy_cache_valid 404 1m;\n        add_header X-Cache-Status $upstream_cache_status;\n        \n        # Cache bypass\n        proxy_cache_bypass $http_cache_control;\n        \n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"fichiers-statiques",children:"Fichiers statiques"}),"\n",(0,i.jsx)(n.p,{children:"Servir fichiers statiques directement (meilleure performance)."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-nginx",children:'server {\n    listen 443 ssl http2;\n    server_name monsite.com;\n\n    root /var/www/monsite;\n    index index.html;\n\n    # Assets statiques\n    location ~* \\.(jpg|jpeg|png|gif|ico|css|js|svg|woff|woff2|ttf|eot)$ {\n        expires 1y;\n        add_header Cache-Control "public, immutable";\n    }\n\n    # API requests vers backend\n    location /api/ {\n        proxy_pass http://localhost:3000;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n    }\n\n    # SPA fallback\n    location / {\n        try_files $uri $uri/ /index.html;\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"s\xe9curit\xe9",children:"S\xe9curit\xe9"}),"\n",(0,i.jsx)(n.h3,{id:"rate-limiting",children:"Rate limiting"}),"\n",(0,i.jsx)(n.p,{children:"Protection contre abus."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-nginx",children:"# D\xe9finir zone rate limit\nlimit_req_zone $binary_remote_addr zone=general:10m rate=10r/s;\nlimit_req_zone $binary_remote_addr zone=login:10m rate=3r/m;\n\nserver {\n    listen 443 ssl http2;\n    server_name monsite.com;\n\n    # Rate limit g\xe9n\xe9ral\n    location / {\n        limit_req zone=general burst=20 nodelay;\n        proxy_pass http://localhost:3000;\n    }\n\n    # Rate limit strict pour login\n    location /api/login {\n        limit_req zone=login burst=5;\n        proxy_pass http://localhost:3000;\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"headers-de-s\xe9curit\xe9",children:"Headers de s\xe9curit\xe9"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-nginx",children:'server {\n    listen 443 ssl http2;\n    server_name monsite.com;\n\n    # Security headers\n    add_header X-Frame-Options "SAMEORIGIN" always;\n    add_header X-Content-Type-Options "nosniff" always;\n    add_header X-XSS-Protection "1; mode=block" always;\n    add_header Referrer-Policy "no-referrer-when-downgrade" always;\n    add_header Content-Security-Policy "default-src \'self\' https:; script-src \'self\' \'unsafe-inline\'; style-src \'self\' \'unsafe-inline\'" always;\n    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;\n\n    location / {\n        proxy_pass http://localhost:3000;\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"restriction-ip",children:"Restriction IP"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-nginx",children:"server {\n    listen 443 ssl http2;\n    server_name admin.monsite.com;\n\n    # Whitelist IPs\n    allow 1.2.3.4;\n    allow 5.6.7.8;\n    deny all;\n\n    location / {\n        proxy_pass http://localhost:8080;\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"basic-auth",children:"Basic Auth"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-nginx",children:'server {\n    listen 443 ssl http2;\n    server_name private.monsite.com;\n\n    auth_basic "Restricted Area";\n    auth_basic_user_file /etc/nginx/.htpasswd;\n\n    location / {\n        proxy_pass http://localhost:9000;\n    }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Cr\xe9er .htpasswd :"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo apt install apache2-utils\nsudo htpasswd -c /etc/nginx/.htpasswd username\n"})}),"\n",(0,i.jsx)(n.h2,{id:"monitoring-et-logs",children:"Monitoring et logs"}),"\n",(0,i.jsx)(n.h3,{id:"logs-par-vhost",children:"Logs par vhost"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-nginx",children:"server {\n    listen 443 ssl http2;\n    server_name monsite.com;\n\n    access_log /var/log/nginx/monsite-access.log;\n    error_log /var/log/nginx/monsite-error.log;\n\n    location / {\n        proxy_pass http://localhost:3000;\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"format-de-log-personnalis\xe9",children:"Format de log personnalis\xe9"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-nginx",children:'log_format detailed \'$remote_addr - $remote_user [$time_local] \'\n                    \'"$request" $status $body_bytes_sent \'\n                    \'"$http_referer" "$http_user_agent" \'\n                    \'rt=$request_time uct="$upstream_connect_time" \'\n                    \'uht="$upstream_header_time" urt="$upstream_response_time"\';\n\naccess_log /var/log/nginx/detailed.log detailed;\n'})}),"\n",(0,i.jsx)(n.h3,{id:"analyser-logs",children:"Analyser logs"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Top 10 IPs\nawk '{print $1}' /var/log/nginx/access.log | sort | uniq -c | sort -rn | head -10\n\n# Top 10 pages\nawk '{print $7}' /var/log/nginx/access.log | sort | uniq -c | sort -rn | head -10\n\n# Codes d'erreur\nawk '{print $9}' /var/log/nginx/access.log | sort | uniq -c | sort -rn\n"})}),"\n",(0,i.jsx)(n.h2,{id:"d\xe9pannage",children:"D\xe9pannage"}),"\n",(0,i.jsx)(n.h3,{id:"tester-configuration",children:"Tester configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# V\xe9rifier syntaxe\nsudo nginx -t\n\n# Verbose\nsudo nginx -T\n"})}),"\n",(0,i.jsx)(n.h3,{id:"502-bad-gateway",children:'"502 Bad Gateway"'}),"\n",(0,i.jsx)(n.p,{children:"Backend inaccessible."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"V\xe9rifications :"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Backend tourne-t-il ?\nsudo lsof -i :3000\n\n# Nginx peut-il y acc\xe9der ?\ncurl http://localhost:3000\n\n# SELinux bloque ? (CentOS)\nsudo setsebool -P httpd_can_network_connect 1\n"})}),"\n",(0,i.jsx)(n.h3,{id:"504-gateway-timeout",children:'"504 Gateway Timeout"'}),"\n",(0,i.jsx)(n.p,{children:"Backend r\xe9pond trop lentement."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Solution :"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-nginx",children:"location / {\n    proxy_pass http://localhost:3000;\n    proxy_connect_timeout 300;\n    proxy_send_timeout 300;\n    proxy_read_timeout 300;\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"logs-en-temps-r\xe9el",children:"Logs en temps r\xe9el"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Access logs\nsudo tail -f /var/log/nginx/access.log\n\n# Error logs\nsudo tail -f /var/log/nginx/error.log\n\n# Tous les logs\nsudo tail -f /var/log/nginx/*.log\n"})}),"\n",(0,i.jsx)(n.h2,{id:"best-practices",children:"Best practices"}),"\n",(0,i.jsx)(n.h3,{id:"structure-organis\xe9e",children:"Structure organis\xe9e"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"/etc/nginx/\n\u251c\u2500\u2500 nginx.conf\n\u251c\u2500\u2500 sites-available/\n\u2502   \u251c\u2500\u2500 01-monsite.conf\n\u2502   \u251c\u2500\u2500 02-api.conf\n\u2502   \u2514\u2500\u2500 03-admin.conf\n\u2514\u2500\u2500 sites-enabled/\n    \u251c\u2500\u2500 01-monsite.conf -> ../sites-available/01-monsite.conf\n    \u251c\u2500\u2500 02-api.conf -> ../sites-available/02-api.conf\n    \u2514\u2500\u2500 03-admin.conf -> ../sites-available/03-admin.conf\n"})}),"\n",(0,i.jsx)(n.p,{children:"Pr\xe9fixes num\xe9riques = ordre de chargement."}),"\n",(0,i.jsx)(n.h3,{id:"fichiers-include",children:"Fichiers include"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"snippets/proxy-params.conf :"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-nginx",children:"proxy_set_header Host $host;\nproxy_set_header X-Real-IP $remote_addr;\nproxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\nproxy_set_header X-Forwarded-Proto $scheme;\nproxy_http_version 1.1;\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Utilisation :"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-nginx",children:"server {\n    location / {\n        proxy_pass http://localhost:3000;\n        include snippets/proxy-params.conf;\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"reload-vs-restart",children:"Reload vs Restart"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Reload (pas de downtime)\nsudo systemctl reload nginx\n\n# Restart (downtime court)\nsudo systemctl restart nginx\n"})}),"\n",(0,i.jsx)(n.h2,{id:"ressources",children:"Ressources"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://nginx.org/en/docs/",children:"Nginx Documentation"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.digitalocean.com/community/tools/nginx",children:"Nginx Config Generator"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://ssl-config.mozilla.org/",children:"Mozilla SSL Config"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://certbot.eff.org/docs/",children:"Certbot Documentation"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"support",children:"Support"}),"\n",(0,i.jsxs)(n.p,{children:["Questions sur reverse proxy ? ",(0,i.jsx)(n.a,{href:"https://discord.gg/UaHNnMarQA",children:"Discord LKL Cloud"})]})]})}function p(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453(e,n,s){s.d(n,{R:()=>o,x:()=>a});var r=s(6540);const i={},t=r.createContext(i);function o(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);