"use strict";(globalThis.webpackChunkmon_site=globalThis.webpackChunkmon_site||[]).push([[7540],{8453(e,n,s){s.d(n,{R:()=>o,x:()=>a});var i=s(6540);const r={},l=i.createContext(r);function o(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(l.Provider,{value:n},e.children)}},8917(e,n,s){s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>t});const i=JSON.parse('{"id":"fivem/mysql","title":"Lier la base de donn\xe9es MySQL \xe0 FiveM","description":"Configuration compl\xe8te de MySQL pour votre serveur FiveM et int\xe9gration avec oxmysql.","source":"@site/docs/fivem/mysql.md","sourceDirName":"fivem","slug":"/fivem/mysql","permalink":"/fivem/mysql","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1771969376000,"frontMatter":{"title":"Lier la base de donn\xe9es MySQL \xe0 FiveM"},"sidebar":"docs","previous":{"title":"Activer et configurer txAdmin","permalink":"/fivem/txadmin"},"next":{"title":"Importer et compresser un fichier SQL","permalink":"/fivem/onesync"}}');var r=s(4848),l=s(8453);const o={title:"Lier la base de donn\xe9es MySQL \xe0 FiveM"},a=void 0,c={},t=[{value:"Pourquoi utiliser MySQL ?",id:"pourquoi-utiliser-mysql-",level:2},{value:"Pr\xe9requis",id:"pr\xe9requis",level:2},{value:"Cr\xe9er une base de donn\xe9es",id:"cr\xe9er-une-base-de-donn\xe9es",level:3},{value:"Informations de connexion",id:"informations-de-connexion",level:3},{value:"Installation oxmysql",id:"installation-oxmysql",level:2},{value:"T\xe9l\xe9chargement",id:"t\xe9l\xe9chargement",level:3},{value:"Configuration",id:"configuration",level:3},{value:"Format de connexion",id:"format-de-connexion",level:3},{value:"Import base de donn\xe9es",id:"import-base-de-donn\xe9es",level:2},{value:"Import via phpMyAdmin",id:"import-via-phpmyadmin",level:3},{value:"Import via ligne de commande",id:"import-via-ligne-de-commande",level:3},{value:"Import manuel des tables",id:"import-manuel-des-tables",level:3},{value:"Frameworks avec MySQL",id:"frameworks-avec-mysql",level:2},{value:"ESX Legacy",id:"esx-legacy",level:3},{value:"QBCore Framework",id:"qbcore-framework",level:3},{value:"Utilisation dans vos scripts",id:"utilisation-dans-vos-scripts",level:2},{value:"Queries basiques (oxmysql)",id:"queries-basiques-oxmysql",level:3},{value:"Queries modernes (exports)",id:"queries-modernes-exports",level:3},{value:"Transactions",id:"transactions",level:3},{value:"Optimisation MySQL",id:"optimisation-mysql",level:2},{value:"Index sur tables",id:"index-sur-tables",level:3},{value:"Configuration MySQL",id:"configuration-mysql",level:3},{value:"Connection pooling",id:"connection-pooling",level:3},{value:"Requ\xeates optimis\xe9es",id:"requ\xeates-optimis\xe9es",level:3},{value:"S\xe9curit\xe9",id:"s\xe9curit\xe9",level:2},{value:"Prepared Statements",id:"prepared-statements",level:3},{value:"Permissions utilisateur",id:"permissions-utilisateur",level:3},{value:"Mots de passe",id:"mots-de-passe",level:3},{value:"Backup r\xe9guliers",id:"backup-r\xe9guliers",level:3},{value:"D\xe9pannage",id:"d\xe9pannage",level:2},{value:"&quot;Can&#39;t connect to MySQL server&quot;",id:"cant-connect-to-mysql-server",level:3},{value:"&quot;Access denied for user&quot;",id:"access-denied-for-user",level:3},{value:"&quot;Table doesn&#39;t exist&quot;",id:"table-doesnt-exist",level:3},{value:"Queries lentes",id:"queries-lentes",level:3},{value:"&quot;Too many connections&quot;",id:"too-many-connections",level:3},{value:"Connection lost / Timeout",id:"connection-lost--timeout",level:3},{value:"Migration de mysql-async vers oxmysql",id:"migration-de-mysql-async-vers-oxmysql",level:2},{value:"Monitoring",id:"monitoring",level:2},{value:"Surveiller performance",id:"surveiller-performance",level:3},{value:"Logs oxmysql",id:"logs-oxmysql",level:3},{value:"Ressources",id:"ressources",level:2},{value:"Support",id:"support",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"Configuration compl\xe8te de MySQL pour votre serveur FiveM et int\xe9gration avec oxmysql."}),"\n",(0,r.jsx)(n.h2,{id:"pourquoi-utiliser-mysql-",children:"Pourquoi utiliser MySQL ?"}),"\n",(0,r.jsx)(n.p,{children:"MySQL est indispensable pour la persistance des donn\xe9es sur les serveurs FiveM modernes."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Utilisations :"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Inventaires joueurs"}),"\n",(0,r.jsx)(n.li,{children:"\xc9conomie et comptes bancaires"}),"\n",(0,r.jsx)(n.li,{children:"V\xe9hicules poss\xe9d\xe9s"}),"\n",(0,r.jsx)(n.li,{children:"Propri\xe9t\xe9s et maisons"}),"\n",(0,r.jsx)(n.li,{children:"Statistiques et progression"}),"\n",(0,r.jsx)(n.li,{children:"Donn\xe9es de framework (ESX, QBCore)"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"pr\xe9requis",children:"Pr\xe9requis"}),"\n",(0,r.jsx)(n.h3,{id:"cr\xe9er-une-base-de-donn\xe9es",children:"Cr\xe9er une base de donn\xe9es"}),"\n",(0,r.jsx)(n.p,{children:"Via le panel Plesk ou phpMyAdmin :"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Connectez-vous \xe0 votre panel"}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Bases de donn\xe9es"})," > ",(0,r.jsx)(n.strong,{children:"Ajouter une base de donn\xe9es"})]}),"\n",(0,r.jsxs)(n.li,{children:["Nom : ",(0,r.jsx)(n.code,{children:"fivem_server"})]}),"\n",(0,r.jsxs)(n.li,{children:["Utilisateur : ",(0,r.jsx)(n.code,{children:"fivem_user"})]}),"\n",(0,r.jsx)(n.li,{children:"Mot de passe : [g\xe9n\xe9rez un mot de passe fort]"}),"\n",(0,r.jsx)(n.li,{children:"Permissions : Toutes sur cette base"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"informations-de-connexion",children:"Informations de connexion"}),"\n",(0,r.jsx)(n.p,{children:"Notez ces informations :"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Host: localhost (ou IP si distant)\nPort: 3306\nDatabase: fivem_server\nUsername: fivem_user\nPassword: votre_mot_de_passe\n"})}),"\n",(0,r.jsx)(n.h2,{id:"installation-oxmysql",children:"Installation oxmysql"}),"\n",(0,r.jsx)(n.p,{children:"oxmysql est le connecteur MySQL moderne pour FiveM, rempla\xe7ant mysql-async."}),"\n",(0,r.jsx)(n.h3,{id:"t\xe9l\xe9chargement",children:"T\xe9l\xe9chargement"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Via GitHub (Recommand\xe9) :"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["T\xe9l\xe9chargez depuis ",(0,r.jsx)(n.a,{href:"https://github.com/overextended/oxmysql/releases",children:"https://github.com/overextended/oxmysql/releases"})]}),"\n",(0,r.jsxs)(n.li,{children:["Extrayez dans ",(0,r.jsx)(n.code,{children:"resources/[standalone]/oxmysql/"})]}),"\n",(0,r.jsxs)(n.li,{children:["Ajoutez dans ",(0,r.jsx)(n.code,{children:"server.cfg"})," :"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:"ensure oxmysql\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Via txAdmin :"})}),"\n",(0,r.jsx)(n.p,{children:"Si vous utilisez txAdmin, oxmysql est souvent pr\xe9-install\xe9."}),"\n",(0,r.jsx)(n.h3,{id:"configuration",children:"Configuration"}),"\n",(0,r.jsxs)(n.p,{children:["Dans ",(0,r.jsx)(n.code,{children:"server.cfg"}),", ",(0,r.jsx)(n.strong,{children:"AVANT"})," toute ressource utilisant MySQL :"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:'# MySQL Configuration\nset mysql_connection_string "mysql://fivem_user:password@localhost/fivem_server?charset=utf8mb4"\n\n# Alternative avec param\xe8tres s\xe9par\xe9s\n# set mysql_connection_string "user=fivem_user;password=password;host=localhost;port=3306;database=fivem_server"\n\n# Ensure oxmysql AVANT les autres ressources\nensure oxmysql\n\n# Debug (d\xe9sactivez en production)\nset mysql_debug 0\nset mysql_slow_query_warning 150\n\n# Puis vos frameworks\nensure es_extended\nensure qb-core\n'})}),"\n",(0,r.jsx)(n.h3,{id:"format-de-connexion",children:"Format de connexion"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Format URI (Recommand\xe9) :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:"mysql://utilisateur:motdepasse@host:port/database?charset=utf8mb4\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Exemples :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:'# Serveur local\nset mysql_connection_string "mysql://fivem:Pass123!@localhost/fivem_db?charset=utf8mb4"\n\n# Serveur distant\nset mysql_connection_string "mysql://user:pass@192.168.1.100:3306/fivem?charset=utf8mb4"\n\n# Avec options SSL\nset mysql_connection_string "mysql://user:pass@host/db?ssl=true&charset=utf8mb4"\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Format param\xe8tres :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:'set mysql_connection_string "user=fivem;password=Pass123;host=localhost;port=3306;database=fivem_db"\n'})}),"\n",(0,r.jsx)(n.h2,{id:"import-base-de-donn\xe9es",children:"Import base de donn\xe9es"}),"\n",(0,r.jsx)(n.h3,{id:"import-via-phpmyadmin",children:"Import via phpMyAdmin"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Connectez-vous \xe0 ",(0,r.jsx)(n.strong,{children:"phpMyAdmin"})]}),"\n",(0,r.jsxs)(n.li,{children:["S\xe9lectionnez votre base ",(0,r.jsx)(n.code,{children:"fivem_server"})]}),"\n",(0,r.jsxs)(n.li,{children:["Onglet ",(0,r.jsx)(n.strong,{children:"Importer"})]}),"\n",(0,r.jsxs)(n.li,{children:["Choisissez le fichier ",(0,r.jsx)(n.code,{children:".sql"})," (fourni par ESX/QBCore)"]}),"\n",(0,r.jsx)(n.li,{children:"Format : SQL"}),"\n",(0,r.jsxs)(n.li,{children:["Cliquez ",(0,r.jsx)(n.strong,{children:"Ex\xe9cuter"})]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"import-via-ligne-de-commande",children:"Import via ligne de commande"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"mysql -u fivem_user -p fivem_server < framework.sql\n"})}),"\n",(0,r.jsx)(n.p,{children:"Entrez le mot de passe quand demand\xe9."}),"\n",(0,r.jsx)(n.h3,{id:"import-manuel-des-tables",children:"Import manuel des tables"}),"\n",(0,r.jsx)(n.p,{children:"Si vous avez des fichiers SQL s\xe9par\xe9s :"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd /votre/serveur/resources/es_extended/\nmysql -u fivem_user -p fivem_server < sql/legacy.sql\n"})}),"\n",(0,r.jsx)(n.h2,{id:"frameworks-avec-mysql",children:"Frameworks avec MySQL"}),"\n",(0,r.jsx)(n.h3,{id:"esx-legacy",children:"ESX Legacy"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Installation base de donn\xe9es :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Tables ESX\nmysql -u fivem_user -p fivem_server < resources/[esx]/es_extended/sql/legacy.sql\n\n# Jobs\nmysql -u fivem_user -p fivem_server < resources/[esx]/esx_society/sql/society.sql\n\n# Autres resources\nmysql -u fivem_user -p fivem_server < resources/[esx]/esx_property/sql/property.sql\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Configuration ESX :"})}),"\n",(0,r.jsxs)(n.p,{children:["Dans ",(0,r.jsx)(n.code,{children:"resources/[esx]/es_extended/config.lua"})," :"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:"Config.EnableDefaultInventory = true\nConfig.MaxWeight = 24\nConfig.PaycheckInterval = 7 * 60000 -- 7 minutes\n\nConfig.Accounts = {\n    bank = _U('account_bank'),\n    black_money = _U('account_black_money'),\n    money = _U('account_money')\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Server.cfg :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:"ensure oxmysql\nensure es_extended\nensure esx_menu_default\nensure esx_menu_dialog\nensure esx_menu_list\n"})}),"\n",(0,r.jsx)(n.h3,{id:"qbcore-framework",children:"QBCore Framework"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Installation :"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Import de ",(0,r.jsx)(n.code,{children:"qbcore.sql"})," :"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"mysql -u fivem_user -p fivem_server < qbcore.sql\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsxs)(n.li,{children:["Configuration ",(0,r.jsx)(n.code,{children:"qb-core/config.lua"})," :"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:"QBConfig = {}\nQBConfig.MaxPlayers = 32\nQBConfig.DefaultSpawn = vector4(-1035.71, -2731.87, 12.86, 0.0)\nQBConfig.UpdateInterval = 5\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsx)(n.li,{children:"Server.cfg :"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:"ensure oxmysql\nensure qb-core\nensure qb-multicharacter\nensure qb-spawn\nensure qb-apartments\nensure qb-garages\n"})}),"\n",(0,r.jsx)(n.h2,{id:"utilisation-dans-vos-scripts",children:"Utilisation dans vos scripts"}),"\n",(0,r.jsx)(n.h3,{id:"queries-basiques-oxmysql",children:"Queries basiques (oxmysql)"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"SELECT - R\xe9cup\xe9rer des donn\xe9es :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:"-- Single row\nMySQL.Async.fetchScalar('SELECT money FROM users WHERE identifier = ?', {identifier}, function(money)\n    print('Argent: ' .. money)\nend)\n\n-- Single row avec plusieurs colonnes\nMySQL.Async.fetchAll('SELECT * FROM users WHERE identifier = ?', {identifier}, function(result)\n    if result[1] then\n        print('Nom: ' .. result[1].firstname)\n        print('Argent: ' .. result[1].money)\n    end\nend)\n\n-- Multiple rows\nMySQL.Async.fetchAll('SELECT * FROM vehicles WHERE owner = ?', {owner}, function(vehicles)\n    for k, v in pairs(vehicles) do\n        print('V\xe9hicule: ' .. v.plate)\n    end\nend)\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"INSERT - Ins\xe9rer des donn\xe9es :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:"MySQL.Async.execute('INSERT INTO owned_vehicles (owner, plate, vehicle, stored) VALUES (?, ?, ?, ?)', {\n    owner,\n    plate,\n    json.encode(vehicle),\n    1\n}, function(rowsChanged)\n    print('V\xe9hicule ajout\xe9!')\nend)\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"UPDATE - Mettre \xe0 jour :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:"MySQL.Async.execute('UPDATE users SET money = ? WHERE identifier = ?', {\n    newMoney,\n    identifier\n}, function(affectedRows)\n    print('Argent mis \xe0 jour!')\nend)\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"DELETE - Supprimer :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:"MySQL.Async.execute('DELETE FROM owned_vehicles WHERE plate = ?', {\n    plate\n}, function(rowsChanged)\n    print('V\xe9hicule supprim\xe9!')\nend)\n"})}),"\n",(0,r.jsx)(n.h3,{id:"queries-modernes-exports",children:"Queries modernes (exports)"}),"\n",(0,r.jsx)(n.p,{children:"oxmysql offre aussi une syntaxe moderne :"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:"-- Async/Await style\nlocal result = MySQL.query.await('SELECT * FROM users WHERE identifier = ?', {identifier})\n\n-- Single value\nlocal money = MySQL.scalar.await('SELECT money FROM users WHERE identifier = ?', {identifier})\n\n-- Insert et r\xe9cup\xe9rer ID\nlocal insertId = MySQL.insert.await('INSERT INTO vehicles (plate, model) VALUES (?, ?)', {plate, model})\n\n-- Update\nlocal affectedRows = MySQL.update.await('UPDATE users SET money = ? WHERE identifier = ?', {money, identifier})\n\n-- Prepare (pour requ\xeates r\xe9p\xe9t\xe9es)\nlocal query = MySQL.prepare.await('SELECT * FROM users WHERE identifier = ?')\nlocal result = query(identifier)\n"})}),"\n",(0,r.jsx)(n.h3,{id:"transactions",children:"Transactions"}),"\n",(0,r.jsx)(n.p,{children:"Pour garantir l'int\xe9grit\xe9 des donn\xe9es :"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:"MySQL.transaction({\n    {query = 'UPDATE users SET money = money - ? WHERE identifier = ?', values = {amount, buyer}},\n    {query = 'UPDATE users SET money = money + ? WHERE identifier = ?', values = {amount, seller}},\n    {query = 'INSERT INTO transactions (buyer, seller, amount) VALUES (?, ?, ?)', values = {buyer, seller, amount}}\n}, function(success)\n    if success then\n        print('Transaction r\xe9ussie!')\n    else\n        print('Transaction annul\xe9e!')\n    end\nend)\n"})}),"\n",(0,r.jsx)(n.h2,{id:"optimisation-mysql",children:"Optimisation MySQL"}),"\n",(0,r.jsx)(n.h3,{id:"index-sur-tables",children:"Index sur tables"}),"\n",(0,r.jsx)(n.p,{children:"Les index acc\xe9l\xe8rent consid\xe9rablement les requ\xeates :"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- Index sur colonnes fr\xe9quemment recherch\xe9es\nCREATE INDEX idx_identifier ON users(identifier);\nCREATE INDEX idx_owner ON owned_vehicles(owner);\nCREATE INDEX idx_plate ON owned_vehicles(plate);\n\n-- Index composites\nCREATE INDEX idx_user_account ON accounts(identifier, name);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"configuration-mysql",children:"Configuration MySQL"}),"\n",(0,r.jsxs)(n.p,{children:["Dans ",(0,r.jsx)(n.code,{children:"/etc/mysql/my.cnf"})," ou via phpMyAdmin :"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ini",children:"[mysqld]\n# InnoDB optimizations\ninnodb_buffer_pool_size = 2G\ninnodb_log_file_size = 512M\ninnodb_flush_log_at_trx_commit = 2\ninnodb_flush_method = O_DIRECT\n\n# Query cache\nquery_cache_type = 1\nquery_cache_size = 64M\nquery_cache_limit = 2M\n\n# Connections\nmax_connections = 200\nconnect_timeout = 10\n\n# Logs (d\xe9sactivez en production)\nslow_query_log = 1\nlong_query_time = 2\n"})}),"\n",(0,r.jsx)(n.h3,{id:"connection-pooling",children:"Connection pooling"}),"\n",(0,r.jsx)(n.p,{children:"oxmysql g\xe8re automatiquement le pool de connexions :"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:'# Dans server.cfg\nset mysql_connection_string "mysql://user:pass@host/db?connectionLimit=10"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"requ\xeates-optimis\xe9es",children:"Requ\xeates optimis\xe9es"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Mauvaise pratique :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:"-- N+1 queries probl\xe9matiques\nfor k, v in pairs(players) do\n    MySQL.Async.fetchAll('SELECT * FROM inventory WHERE owner = ?', {v.identifier})\nend\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Bonne pratique :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:"-- Une seule query avec IN\nlocal identifiers = {}\nfor k, v in pairs(players) do\n    table.insert(identifiers, v.identifier)\nend\n\nMySQL.Async.fetchAll('SELECT * FROM inventory WHERE owner IN (?)', {table.concat(identifiers, ',')})\n"})}),"\n",(0,r.jsx)(n.h2,{id:"s\xe9curit\xe9",children:"S\xe9curit\xe9"}),"\n",(0,r.jsx)(n.h3,{id:"prepared-statements",children:"Prepared Statements"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Toujours"})," utiliser des param\xe8tres (?) :"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:"-- \u2705 BIEN - Protection SQL injection\nMySQL.Async.execute('SELECT * FROM users WHERE name = ?', {playerName})\n\n-- \u274c MAL - Vuln\xe9rable SQL injection\nMySQL.Async.execute('SELECT * FROM users WHERE name = \"' .. playerName .. '\"')\n"})}),"\n",(0,r.jsx)(n.h3,{id:"permissions-utilisateur",children:"Permissions utilisateur"}),"\n",(0,r.jsx)(n.p,{children:"Limitez les permissions de l'utilisateur MySQL :"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- Cr\xe9er utilisateur avec permissions limit\xe9es\nCREATE USER 'fivem_limited'@'localhost' IDENTIFIED BY 'password';\n\n-- Accorder uniquement SELECT, INSERT, UPDATE, DELETE\nGRANT SELECT, INSERT, UPDATE, DELETE ON fivem_server.* TO 'fivem_limited'@'localhost';\n\n-- Pas de DROP, ALTER, etc.\nFLUSH PRIVILEGES;\n"})}),"\n",(0,r.jsx)(n.h3,{id:"mots-de-passe",children:"Mots de passe"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Ne jamais hardcoder dans les scripts :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:"-- \u274c MAL\nlocal password = \"MonMotDePasse123\"\n\n-- \u2705 BIEN - Utiliser convars\nlocal password = GetConvar('mysql_password', '')\n"})}),"\n",(0,r.jsx)(n.h3,{id:"backup-r\xe9guliers",children:"Backup r\xe9guliers"}),"\n",(0,r.jsx)(n.p,{children:"Automatisez les sauvegardes :"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"#!/bin/bash\n# backup-mysql.sh\n\nDATE=$(date +%Y%m%d_%H%M%S)\nmysqldump -u fivem_user -p'password' fivem_server > /backups/fivem_${DATE}.sql\n\n# Compression\ngzip /backups/fivem_${DATE}.sql\n\n# Garder seulement 30 derniers jours\nfind /backups/ -name \"fivem_*.sql.gz\" -mtime +30 -delete\n"})}),"\n",(0,r.jsx)(n.p,{children:"Cron :"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"0 4 * * * /root/backup-mysql.sh\n"})}),"\n",(0,r.jsx)(n.h2,{id:"d\xe9pannage",children:"D\xe9pannage"}),"\n",(0,r.jsx)(n.h3,{id:"cant-connect-to-mysql-server",children:'"Can\'t connect to MySQL server"'}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"V\xe9rifications :"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"MySQL est d\xe9marr\xe9 :"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"systemctl status mysql\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:"Port 3306 ouvert :"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"netstat -tulpn | grep 3306\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsx)(n.li,{children:"Utilisateur a les droits :"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SHOW GRANTS FOR 'fivem_user'@'localhost';\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"4",children:["\n",(0,r.jsx)(n.li,{children:"Test connexion :"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"mysql -u fivem_user -p -h localhost fivem_server\n"})}),"\n",(0,r.jsx)(n.h3,{id:"access-denied-for-user",children:'"Access denied for user"'}),"\n",(0,r.jsx)(n.p,{children:"Mauvais identifiants ou permissions."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Solution :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- R\xe9initialiser password\nALTER USER 'fivem_user'@'localhost' IDENTIFIED BY 'nouveau_password';\nFLUSH PRIVILEGES;\n"})}),"\n",(0,r.jsx)(n.h3,{id:"table-doesnt-exist",children:'"Table doesn\'t exist"'}),"\n",(0,r.jsx)(n.p,{children:"Tables non import\xe9es."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Solution :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# V\xe9rifier tables existantes\nmysql -u fivem_user -p fivem_server -e "SHOW TABLES;"\n\n# Importer fichier SQL manquant\nmysql -u fivem_user -p fivem_server < missing_tables.sql\n'})}),"\n",(0,r.jsx)(n.h3,{id:"queries-lentes",children:"Queries lentes"}),"\n",(0,r.jsx)(n.p,{children:"Activez le slow query log :"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SET GLOBAL slow_query_log = 'ON';\nSET GLOBAL long_query_time = 2;\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Consultez ",(0,r.jsx)(n.code,{children:"/var/log/mysql/slow-query.log"})]}),"\n",(0,r.jsx)(n.p,{children:"Optimisez avec EXPLAIN :"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"EXPLAIN SELECT * FROM users WHERE identifier = 'steam:xxxxx';\n"})}),"\n",(0,r.jsx)(n.h3,{id:"too-many-connections",children:'"Too many connections"'}),"\n",(0,r.jsx)(n.p,{children:"Augmentez la limite :"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SET GLOBAL max_connections = 200;\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Ou dans ",(0,r.jsx)(n.code,{children:"my.cnf"})," :"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ini",children:"[mysqld]\nmax_connections = 200\n"})}),"\n",(0,r.jsx)(n.h3,{id:"connection-lost--timeout",children:"Connection lost / Timeout"}),"\n",(0,r.jsx)(n.p,{children:"Augmentez timeouts :"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ini",children:"[mysqld]\nwait_timeout = 600\ninteractive_timeout = 600\nconnect_timeout = 10\n"})}),"\n",(0,r.jsx)(n.h2,{id:"migration-de-mysql-async-vers-oxmysql",children:"Migration de mysql-async vers oxmysql"}),"\n",(0,r.jsx)(n.p,{children:"Si vous migrez depuis mysql-async :"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Changements de syntaxe :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:"-- mysql-async\nMySQL.Async.fetchAll('SELECT ...', {}, function(result)\nend)\n\n-- oxmysql (compatible)\nMySQL.Async.fetchAll('SELECT ...', {}, function(result)\nend)\n\n-- oxmysql (moderne)\nlocal result = MySQL.query.await('SELECT ...', {})\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Server.cfg :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:"# Remplacez\n# ensure mysql-async\n# Par\nensure oxmysql\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Pas de changement dans vos scripts"})," - oxmysql est r\xe9tro-compatible !"]}),"\n",(0,r.jsx)(n.h2,{id:"monitoring",children:"Monitoring"}),"\n",(0,r.jsx)(n.h3,{id:"surveiller-performance",children:"Surveiller performance"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- Connexions actives\nSHOW PROCESSLIST;\n\n-- Statistiques\nSHOW STATUS LIKE 'Threads_connected';\nSHOW STATUS LIKE 'Questions';\nSHOW STATUS LIKE 'Slow_queries';\n\n-- Tables les plus utilis\xe9es\nSELECT * FROM information_schema.tables \nWHERE table_schema = 'fivem_server' \nORDER BY data_length DESC;\n"})}),"\n",(0,r.jsx)(n.h3,{id:"logs-oxmysql",children:"Logs oxmysql"}),"\n",(0,r.jsx)(n.p,{children:"Activez debug temporairement :"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lua",children:"# server.cfg\nset mysql_debug 1\nset mysql_slow_query_warning 100\n"})}),"\n",(0,r.jsx)(n.p,{children:"Consultez les logs dans la console FiveM."}),"\n",(0,r.jsx)(n.h2,{id:"ressources",children:"Ressources"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://overextended.dev/oxmysql",children:"oxmysql Documentation"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/overextended/oxmysql",children:"GitHub oxmysql"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://dev.mysql.com/doc/",children:"MySQL Documentation"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://documentation.esx-framework.org/",children:"ESX Documentation"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.qbcore.org/",children:"QBCore Docs"})}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"support",children:"Support"}),"\n",(0,r.jsxs)(n.p,{children:["Besoin d'aide ? ",(0,r.jsx)(n.a,{href:"https://discord.gg/UaHNnMarQA",children:"Discord LKL Cloud"})]})]})}function u(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);